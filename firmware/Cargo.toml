[workspace]
members = ["crates/panic_defmt"]

[package]
name = "firmware"
version = "0.0.0"
authors = ["Ryan Butler <thebutlah@gmail.com>"]
edition = "2021"
license = "MIT OR Apache-2.0"

[features]
default = ["esp32c3"]
# In the future, we will support other platforms, selected via feature
esp32c3 = []

[dependencies]
# Platform support
esp32c3-hal = { version = "0.2", features = ["direct-boot"] }
riscv-rt = "0.9"
riscv = "0.8"
esp-alloc = { version = "0.1", features = ["oom-handler"] }

# Embassy stuff
embassy-futures = { git = "https://github.com/embassy-rs/embassy", rev = "cb9f0ef5b800ce4a22cde1805e0eb88425f1e07b" }
embassy-executor = { git = "https://github.com/embassy-rs/embassy", rev = "cb9f0ef5b800ce4a22cde1805e0eb88425f1e07b", features = [
    "nightly",
    # "integrated-timers",
] }
# embassy-time = { git = "https://github.com/embassy-rs/embassy", rev = "cb9f0ef5b800ce4a22cde1805e0eb88425f1e07b", features = [
#     "tick-16mhz",
#     "nightly",
#     "unstable-traits",
# ] }

# Logging
defmt = "0.3"
defmt-rtt = "0.3.2"
panic_defmt = { path = "crates/panic_defmt" }

# Peripherals
mpu6050-dmp = "0.2"
# esp-wifi doesn't seem to be updated for the latest ecosystem crates
# esp-wifi = { git = "https://github.com/esp-rs/esp-wifi", rev = "69956d42d2ddf00dd7021e429ed815f982e35319", features = [
#     "esp32c3",
#     "wifi",
# ] }

# Other crates
static_cell = "1"
nb = "1"
nalgebra = { version = "0.31", default-features = false, features = [
    "macros",
    "libm",
] }
fugit = "0.3"

[patch.crates-io]
# Enable non-default I2C addresses and InitError
mpu6050-dmp = { git = "https://github.com/TheButlah/mpu6050-dmp-rs", rev = "77128a75a51547baadc0f0ef99aba4432e848f10" }

# Works on non atomic targets
defmt-rtt = { git = "https://github.com/knurling-rs/defmt", rev = "8f465a0db78a8f7759452ecba5d1ad3d7d171098" }
defmt = { git = "https://github.com/knurling-rs/defmt", rev = "8f465a0db78a8f7759452ecba5d1ad3d7d171098" }

# Fixes atomic trap handler (only necessary on `-imac` target)
esp32c3-hal = { git = "https://github.com/esp-rs/esp-hal", rev = "af745ac7b0799752260e13573895b97153d85639" }
